<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <script src="angular_sudoku-gh-pages/apps/js/libs/jquery-1.11.3.min.js"></script>
    <script src="angular_sudoku-gh-pages/apps/js/libs/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="angular_sudoku-gh-pages/apps/css/bootstrap.min.css">
    <script src="angular_sudoku-gh-pages/apps/js/libs/angular.min.js"></script>
    <style type="text/css">
        #manual{
            text-align: center;
        }
        #btn{
            margin-top: 20px; 
        }
    </style>
    <script type="text/javascript">
        var Client = angular.module(
            'Client', [],function ($interpolateProvider) {
                $interpolateProvider.startSymbol('{{');
                $interpolateProvider.endSymbol('}}'); 
            }
        ); 
        Client.constant('data',[]);
        Client.controller('ClientController', function ClientController($scope, data) {
            'use strict';

            function getRandomComponentManifestLink(){
                //consulting with 
                // return "http://ithanatos.sytes.net/manifest.json"; //returning the link where the component's manifest exists
                return "https://raw.githubusercontent.com/DarthThanatos/TOIK-GAMES/master/angular_sudoku-gh-pages/manifest.json"
            }

            function getJSON(link, callback) {
                var xobj = new XMLHttpRequest();
                xobj.overrideMimeType("application/json");
                xobj.open('GET', link, true);
                // Replace 'my_data' with the path to your file
                xobj.onreadystatechange = function() {
                    if (xobj.readyState === 4 && xobj.status === 200) {
                        // Required use of an anonymous callback 
                        // as .open() will NOT return a value but simply returns undefined in asynchronous mode
                        callback(xobj.responseText);
                    }
                };
                xobj.send(null);
            }



            $scope.onClick = function(){
                var randomComponentManifestLink = getRandomComponentManifestLink();
                console.log("Getting json")
                 getJSON(randomComponentManifestLink, function(json) {
                    console.log("Got json")

                    var someData_notJSON = JSON.parse(json); 
                    console.log(someData_notJSON); 
                    var component_game_name = "sudoku"
                    //removing component if already exists
                    var element = document.getElementById(component_game_name);
                    if(typeof element !== 'undefined' && element != null) {
                        element.parentNode.removeChild(element);
                        console.log("Removed old element: " + component_game_name);
                    }

                    var fileref=document.createElement('script')
                    fileref.setAttribute("type","text/javascript")
                    fileref.setAttribute("id", component_game_name)
                    document.body.appendChild(fileref);
                    // fileref.setAttribute("src", filename)
                    // window.location = "angular_sudoku-gh-pages/index.html"; 
                });
            }
        });

    </script>
</head>
<body>


    <div id="manual"  style="background-color:lavenderblush;" >
        Simple client for accessing components <br/> 
    </div>

    <div align="center" ng-app="Client">
        <buttontype="button"  id="btn"  class="btn btn-default" ng-controller="ClientController" ng-click="onClick()">
            Play game with the name: bob and with a room: ab34
        </buttontype="button">
    </div>
</body>
</html>
